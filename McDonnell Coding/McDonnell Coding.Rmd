---
title: "McDonnell Coding"
date: "Updated: `r format(Sys.time(), '%B %d, %Y')`"
runtime: shiny
output:
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: yes
    keep_md: true
    theme: cosmo
subtitle: Simulations and Subcodes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include = FALSE}
# Install Packages
library("tidyverse")
library("irr")
library("sjmisc")

```

``` {r include = FALSE}
# Import ELA and Math Data
df_full <- read_csv("McDonnell_CLEAN.csv")

```

# **Simulations**
## Kappas {.tabset}

### ELA

```{r echo=FALSE}
#### Descriptives and Graphs ####
# SHINY
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select PrePost
      checkboxGroupInput(inputId = "prepost", 
                  label = "Pre/Post",
                  choices = c("Pre", "Post"),
                  selected = "Pre"),
      #Select Cycle
      checkboxGroupInput(inputId = "cycle", 
                  label = "Cycle",
                  choices = c("B", "C"),
                  selected = "B"),
      #Select Pair
      checkboxGroupInput(inputId = "pair", 
                  label = "Pair",
                  choices = c("Eagle", "Elephant", "Rabbit", "Raven"),
                  selected = "Rabbit")
    ),
    mainPanel(tabPanel(
      "Sim",
      fluidRow(
        verbatimTextOutput("Table"),
        verbatimTextOutput("Kappa")
        )
    ))
  )
)


# Define Server ####
server <- function(input, output) {
  simData <- reactive({
    df_full %>%
      filter(Content == "ELA", Pair %in% input$pair,
             Cycle %in% input$cycle, PrePost %in% input$prepost) %>%
      select(Simulation1, Simulation2)
    })
  
  output$Table <- renderPrint({
    table(simData()$Simulation1, simData()$Simulation2)
  })
    output$Kappa <- renderPrint({
    kappa2(simData())
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

### Math 
```{r echo=FALSE}
#### Descriptives and Graphs ####
# SHINY
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select PrePost
      checkboxGroupInput(inputId = "prepost", 
                  label = "Pre/Post",
                  choices = c("Pre", "Post"),
                  selected = "Pre"),
      #Select Cycle
      checkboxGroupInput(inputId = "cycle", 
                  label = "Cycle",
                  choices = c("B", "C"),
                  selected = "B"),
      #Select Pair
      checkboxGroupInput(inputId = "pair", 
                  label = "Pair",
                  choices = c("Eggplant", "Endive", "Radish", "Rutabaga"),
                  selected = "Radish")
    ),
    mainPanel(tabPanel(
      "Sim",
      fluidRow(
        verbatimTextOutput("Table"),
        verbatimTextOutput("Kappa")
        )
    ))
  )
)


# Define Server ####
server <- function(input, output) {
  simData <- reactive({
    df_full %>%
      filter(Content == "Math", Pair %in% input$pair,
             Cycle %in% input$cycle, PrePost %in% input$prepost) %>%
      select(Simulation1, Simulation2)
    })
  
  output$Table <- renderPrint({
    table(simData()$Simulation1, simData()$Simulation2)
  })
    output$Kappa <- renderPrint({
    kappa2(simData())
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```


## Plots {.tabset}
### Turns
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col1", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "HiLo"),
      selectInput(inputId = "col2", 
                  label = "Variable2",
                  colnames(df_full), 
                  selected = "HiLo")
    ),
    mainPanel(tabPanel(
      "Plots",
      fluidRow(
        plotOutput("mainPlot")
        )
    )))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    df_full %>%
      filter(Content %in% input$content) %>%
      group_by_at(vars(input$col1, input$col2)) %>%
      mutate(Sim_Pct = mean(Simulation1*100))
  })
  
  output$mainPlot <- renderPlot({
    p1 <- ggplot(data=chartData(), 
           aes_string(x = input$col1, y = "Sim_Pct", fill = input$col2)) + 
      geom_bar(stat="identity", position = "dodge") + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Sim_Pct, digits = 2)), position = position_dodge(width = 1)) +
      coord_cartesian(ylim = c(0,50))
    plot(p1)
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

### Words
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "Cycle")
    ),
    mainPanel(
      tabsetPanel(type = "tabs",
        tabPanel("Overall", plotOutput("mainPlot1")),
        tabPanel("in Sim", plotOutput("mainPlot2"))
      )
    ))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col) 
    df_full %>%
      filter(Content %in% input$content, is.na(Actor) == FALSE) %>%
      group_by_at(vars(input$col, Actor)) %>%
      mutate(Pct_SimWords = mean(SimWords)/mean(Words)*100) %>%
      mutate(Tot_Words = sum(Words)) %>%
      mutate(Tot_SimWords = sum(SimWords))
    })
  
  output$mainPlot1 <- renderPlot({
    p2 <- ggplot(data=chartData(), 
           aes_string(x = input$col, y = "Tot_Words", fill = "Actor")) + 
      geom_bar(stat="identity", position = "dodge", na.rm = TRUE) + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Tot_Words, digits = 2)), 
                position = position_dodge(width = 1), na.rm = TRUE) +
    coord_cartesian(ylim = c(0, 60000)) 
    plot(p2)
    })
  
  output$mainPlot2 <- renderPlot({
    p2 <- ggplot(data=chartData(), 
           aes_string(x = input$col, y = "Tot_SimWords", fill = "Actor")) + 
      geom_bar(stat="identity", position = "dodge", na.rm = TRUE) + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Tot_SimWords, digits = 2)), 
                position = position_dodge(width = 1), na.rm = TRUE) +
    coord_cartesian(ylim = c(0, 60000)) 
    plot(p2)
    })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```


# **Subcodes**
## Kappas {.tabset}
### ELA
```{r echo=FALSE}
#### Descriptives and Graphs ####
# SHINY
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select PrePost
      checkboxGroupInput(inputId = "prepost", 
                  label = "Pre/Post",
                  choices = c("Pre", "Post"),
                  selected = "Pre"),
      #Select Cycle
      checkboxGroupInput(inputId = "cycle", 
                  label = "Cycle",
                  choices = c("B", "C"),
                  selected = "B"),
      #Select Pair
      checkboxGroupInput(inputId = "pair", 
                  label = "Pair",
                  choices = c("Eagle", "Elephant", "Rabbit", "Raven"),
                  selected = "Rabbit")
    ),
    mainPanel(tabPanel(
      "Sub",
      fluidRow(
        verbatimTextOutput("Table"),
        verbatimTextOutput("Kappa")
        )
    ))
  )
)


# Define Server ####
server <- function(input, output) {
  subData <- reactive({
    df_full %>%
      filter(Content == "ELA", Pair %in% input$pair,
             Cycle %in% input$cycle, PrePost %in% input$prepost) %>%
      select(Subcode1, Subcode2)
    })
  
  output$Table <- renderPrint({
    table(subData()$Subcode1, subData()$Subcode2)
  })
    output$Kappa <- renderPrint({
    kappa2(subData())
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

### Math
```{r echo=FALSE}
#### Descriptives and Graphs ####
# SHINY
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select PrePost
      checkboxGroupInput(inputId = "prepost", 
                  label = "Pre/Post",
                  choices = c("Pre", "Post"),
                  selected = "Pre"),
      #Select Cycle
      checkboxGroupInput(inputId = "cycle", 
                  label = "Cycle",
                  choices = c("B", "C"),
                  selected = "B"),
      #Select Pair
      checkboxGroupInput(inputId = "pair", 
                  label = "Pair",
                  choices = c("Eggplant", "Endive", "Radish", "Rutabaga"),
                  selected = "Radish")
    ),
    mainPanel(tabPanel(
      "Sub",
      fluidRow(
        verbatimTextOutput("Table"),
        verbatimTextOutput("Kappa")
        )
    ))
  )
)


# Define Server ####
server <- function(input, output) {
  subData <- reactive({
    df_full %>%
      filter(Content == "Math", Pair %in% input$pair,
             Cycle %in% input$cycle, PrePost %in% input$prepost) %>%
      select(Subcode1, Subcode2)
    })
  
  output$Table <- renderPrint({
    table(subData()$Subcode1, subData()$Subcode2)
  })
    output$Kappa <- renderPrint({
    kappa2(subData())
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```


## Plots 
### Ambiguities {.tabset}
#### Turns
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col1", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "HiLo"),
      selectInput(inputId = "col2", 
                  label = "Variable2",
                  colnames(df_full), 
                  selected = "HiLo")
    ),
    mainPanel(tabPanel(
      "Plots",
      fluidRow(
        plotOutput("mainPlot")
        )
    )))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col1, input$col2) 
    df_full %>%
      filter(Content %in% input$content) %>%
      group_by_at(vars(input$col1, input$col2)) %>%
      mutate(Ambig_Pct = mean(Ambig1*100))
  })
  
  output$mainPlot <- renderPlot({
    p1 <- ggplot(data=chartData(), 
           aes_string(x = input$col1, y = "Ambig_Pct", fill = input$col2)) + 
      geom_bar(stat="identity", position = "dodge") + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Ambig_Pct, digits = 2)), 
                position = position_dodge(width = 1)) +
      coord_cartesian(ylim = c(0,50))
    plot(p1)
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

#### Words
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "Cycle")
    ),
    mainPanel(
      tabsetPanel(type = "tabs",
        tabPanel("Overall", plotOutput("mainPlot1"))
      )
    ))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col) 
    df_full %>%
      filter(Content %in% input$content, is.na(Actor) == FALSE) %>%
      group_by_at(vars(input$col, Actor)) %>%
      mutate(Pct_Ambig = mean(AmbigWords)/mean(Words)*100) %>%
      mutate(Tot_Amibig = sum(AmbigWords))
    })
  
  output$mainPlot1 <- renderPlot({
    p2 <- ggplot(data=chartData(), 
           aes_string(x = input$col, y = "Tot_Amibig", fill = "Actor")) + 
      geom_bar(stat="identity", position = "dodge", na.rm = TRUE) + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Tot_Amibig, digits = 2)), 
                position = position_dodge(width = 1), na.rm = TRUE) +
    coord_cartesian(ylim = c(0, 15000)) 
    plot(p2)
    })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

### Alternatives {.tabset}
#### Turns
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col1", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "HiLo"),
      selectInput(inputId = "col2", 
                  label = "Variable2",
                  colnames(df_full), 
                  selected = "HiLo")
    ),
    mainPanel(tabPanel(
      "Plots",
      fluidRow(
        plotOutput("mainPlot")
        )
    )))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col1, input$col2) 
    df_full %>%
      filter(Sim_Any == 1, Content %in% input$content) %>%
      group_by_at(vars(input$col1, input$col2)) %>%
      mutate(Alt_Pct = mean(Alt1*100))
  })
  
  output$mainPlot <- renderPlot({
    p1 <- ggplot(data=chartData(), 
           aes_string(x = input$col1, y = "Alt_Pct", fill = input$col2)) + 
      geom_bar(stat="identity", position = "dodge") + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Alt_Pct, digits = 2)), position = position_dodge(width = 1)) +
      coord_cartesian(ylim = c(0,50))
    plot(p1)
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

#### Words
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "Cycle")
    ),
    mainPanel(
      tabsetPanel(type = "tabs",
        tabPanel("Overall", plotOutput("mainPlot1"))
      )
    ))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col) 
    df_full %>%
      filter(Content %in% input$content, is.na(Actor) == FALSE) %>%
      group_by_at(vars(input$col, Actor)) %>%
      mutate(Pct_Alt = mean(AltWords)/mean(Words)*100) %>%
      mutate(Tot_Alt = sum(AltWords))
    })
  
  output$mainPlot1 <- renderPlot({
    p2 <- ggplot(data=chartData(), 
           aes_string(x = input$col, y = "Tot_Alt", fill = "Actor")) + 
      geom_bar(stat="identity", position = "dodge", na.rm = TRUE) + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Tot_Alt, digits = 2)), 
                position = position_dodge(width = 1), na.rm = TRUE) +
    coord_cartesian(ylim = c(0, 15000)) 
    plot(p2)
    })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

### Weighing Alts. {.tabset}
#### Turns
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col1", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "HiLo"),
      selectInput(inputId = "col2", 
                  label = "Variable2",
                  colnames(df_full), 
                  selected = "HiLo")
    ),
    mainPanel(tabPanel(
      "Plots",
      fluidRow(
        plotOutput("mainPlot")
        )
    )))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col1, input$col2) 
    df_full %>%
      filter(Sim_Any == 1, Content %in% input$content) %>%
      group_by_at(vars(input$col1, input$col2)) %>%
      mutate(Eval_Pct = mean(Eval1*100))
  })
  
  output$mainPlot <- renderPlot({
    p1 <- ggplot(data=chartData(), 
           aes_string(x = input$col1, y = "Eval_Pct", fill = input$col2)) + 
      geom_bar(stat="identity", position = "dodge") + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Eval_Pct, digits = 2)), 
                position = position_dodge(width = 1)) +
      coord_cartesian(ylim = c(0,50))
    plot(p1)
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

#### Words
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "Cycle")
    ),
    mainPanel(
      tabsetPanel(type = "tabs",
        tabPanel("Overall", plotOutput("mainPlot1"))
      )
    ))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col) 
    df_full %>%
      filter(Content %in% input$content, is.na(Actor) == FALSE) %>%
      group_by_at(vars(input$col, Actor)) %>%
      mutate(Pct_Eval = mean(EvalWords)/mean(Words)*100) %>%
      mutate(Tot_Eval = sum(EvalWords))
    })
  
  output$mainPlot1 <- renderPlot({
    p2 <- ggplot(data=chartData(), 
           aes_string(x = input$col, y = "Tot_Eval", fill = "Actor")) + 
      geom_bar(stat="identity", position = "dodge", na.rm = TRUE) + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Tot_Eval, digits = 2)), 
                position = position_dodge(width = 1), na.rm = TRUE) +
    coord_cartesian(ylim = c(0, 15000)) 
    plot(p2)
    })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

### Relaunches {.tabset}
#### Turns
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col1", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "HiLo"),
      selectInput(inputId = "col2", 
                  label = "Variable2",
                  colnames(df_full), 
                  selected = "HiLo")
    ),
    mainPanel(tabPanel(
      "Plots",
      fluidRow(
        plotOutput("mainPlot")
        )
    )))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col1, input$col2) 
    df_full %>%
      filter(Sim_Any == 1, Content %in% input$content) %>%
      group_by_at(vars(input$col1, input$col2)) %>%
      mutate(Rel_Pct = mean(Rel1*100))
  })
  
  output$mainPlot <- renderPlot({
    p1 <- ggplot(data=chartData(), 
           aes_string(x = input$col1, y = "Rel_Pct", fill = input$col2)) + 
      geom_bar(stat="identity", position = "dodge") + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Rel_Pct, digits = 2)), position = position_dodge(width = 1)) +
      coord_cartesian(ylim = c(0,50))
    plot(p1)
  })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```

#### Words
```{r echo=FALSE}
# Define UI ####
ui <- fluidPage(
  sidebarLayout(
    sidebarPanel(
      #Select Content
      selectInput(inputId = "content", 
                  label = "Content",
                  choices = unique(df_full$Content),
                  selected = "ELA"),
      #Select Variables as Groups
      selectInput(inputId = "col", 
                  label = "Variable1",
                  colnames(df_full), 
                  selected = "Cycle")
    ),
    mainPanel(
      tabsetPanel(type = "tabs",
        tabPanel("Overall", plotOutput("mainPlot1"))
      )
    ))
  )

# Define Server ####
server <- function(input, output) {
  chartData <- reactive({
    req(input$content, input$col) 
    df_full %>%
      filter(Content %in% input$content, is.na(Actor) == FALSE) %>%
      group_by_at(vars(input$col, Actor)) %>%
      mutate(Pct_Rel = mean(RelWords)/mean(Words)*100) %>%
      mutate(Tot_Rel = sum(RelWords))
    })
  
  output$mainPlot1 <- renderPlot({
    p2 <- ggplot(data=chartData(), 
           aes_string(x = input$col, y = "Tot_Rel", fill = "Actor")) + 
      geom_bar(stat="identity", position = "dodge", na.rm = TRUE) + 
      scale_fill_brewer(palette = "Set1") +
      geom_text(aes(label=round(Tot_Rel, digits = 2)), 
                position = position_dodge(width = 1), na.rm = TRUE) +
    coord_cartesian(ylim = c(0, 15000)) 
    plot(p2)
    })
}

# Launch Shiny App ####
shinyApp(ui = ui, server = server)

```
